# 勉強日記

## 日付
2026年02月27日

## 学習内容

- **EC2 Image Builder / ゴールデンイメージ**
    - **概要**: ソフトウェアをプリインストールしたカスタムAMIを作成し、起動時のセットアップ時間を排除する手法。
    - **試験ポイント**: Auto Scalingの「起動遅延」問題への最適解。UserDataによる起動時インストールをやめ、事前にAMI化（ゴールデンイメージ）して即応性を高める点が頻出。
    - **実務での使い方**: 定期的なパッチ適用やセキュリティ要件の反映をImage Builderのパイプラインで自動化。常に最新のAMIからスケールアウトする「Immutable Infrastructure」を実現する。
    - **副業での需要**: ★★★★★。IaC構築案件において、起動時間の短縮と一貫性の確保はデプロイ品質に直結するため、非常に提案価値が高い。
    - **要約**: 起動時のインストール処理をAMIに焼き込む（ゴールデンイメージ化）ことで、Auto Scalingの応答性を大幅に向上させ、トラフィック急増への耐性を強化する。

- **Amazon Aurora データ復旧機能の比較**
    - **概要**: Aurora特有の「バックトラック」と、標準的なバックアップ・復元手法の使い分け。
    - **試験ポイント**: **バックトラックが「新しいクラスターを作成せずに既存クラスターを直接巻き戻す」唯一の手段**である点（MySQL専用）が頻出。PITRやスナップショットは「新しいクラスター」が作成される点がひっかけポイント。
    - **実務での使い方**: 誤操作（DELETE文のWHERE句忘れ等）からの緊急復旧にはバックトラックを、中長期的なデータ保護や環境複製にはスナップショット・PITRを利用する。
    - **副業での需要**: ★★★★★。データ損失はビジネス上の致命傷となるため、RPO/RTO要件に合わせた最適な復旧手段を提案できるスキルは高く評価される。

| 機能 | 特徴 | 復元先 | 備考 |
| :--- | :--- | :--- | :--- |
| **自動バックアップ (PITR)** | 1〜35日の保持期間内を秒単位で復元 | **新しいクラスター** | S3に継続保存 |
| **手動スナップショット** | 明示的に作成する完全バックアップ | **新しいクラスター** | 永続保存可能 |
| **バックトラック** | 秒単位で過去の状態へ巻き戻す | **既存クラスター** | **Aurora MySQL専用**、高速復旧 |
| **Auroraレプリカ** | 読み取り分散とHA (フェイルオーバー) | (現行クラスター) | 過去への復旧機能ではない |

- **ECS ネットワークモードと監視の仕組み**
    - **概要**: ECSの3つの通信方式（awsvpc, bridge, host）と、トラフィック・ログ監視の使い分け。
    - **試験ポイント**: **Fargateでは `awsvpc` が必須**である点、タスクレベルのセキュリティグループ適用には `awsvpc` が必要である点が最頻出。
    - **実務での使い方**: 基本は `awsvpc` を選択してタスクごとに独立したIPとSGを付与。性能特化なら `host`、レガシーな構成なら `bridge` を検討する。監視は「通信経路なら VPC Flow Logs」「アプリ内部なら CloudWatch Logs」と切り分ける。
    - **副業での需要**: ★★★★★。ECSのネットワーク設計ミスはセキュリティ事故や性能劣化に直結するため、正しいモード選択と監視設計ができるスキルは需要が高い。

- **Secrets Manager vs SSM Parameter Store**
    - **概要**: どちらも設定値を保存するが、Secrets Managerは「秘密情報の管理・運用（自動更新）」に特化している。
    - **試験ポイント**: **「パスワードの自動ローテーション」** というキーワードがあれば Secrets Manager 一択。コストを抑えたい、あるいは単なる環境変数の管理であれば Parameter Store が正解。
    - **実務での使い方**: RDSの接続情報は Secrets Manager で管理し、Lambda等から。アプリのログレベル設定や共通のAMI IDなどは Parameter Store で管理するのが一般的。
    - **副業での需要**: ★★★★★。セキュリティ意識の高い案件では「パスワードの生書き禁止」は鉄則。Secrets Manager によるローテーション設定まで含めた提案は、単価向上に寄与する。

### 比較まとめ
| 機能 | Secrets Manager | Parameter Store |
| :--- | :--- | :--- |
| **ローテーション** | 自動 (Lambda連携) | なし |
| **データ生成** | ランダム生成機能あり | なし |
| **コスト** | 1秘匿情報ごとに課金 | 基本無料 (標準時) |
| **用途** | DB認証、サードパーティAPIキー | アプリ設定、AMI ID、License |

- **AWS Service Catalog**
    - **概要**: 承認済みのインフラ構成（CloudFormation）を「製品」としてカタログ化し、ユーザーにセルフサービス環境を提供する。
    - **試験ポイント**: **「ガバナンスとセルフサービスの両立」**がキーワード。**起動制約 (Launch Constraints)** を使うことで、ユーザー自身に強いIAM権限を持たせなくても、特定のサービスロール（IAMロール）経由で安全にリソースをデプロイさせることができる。
    - **実務での使い方**: IT部門が「標準的なVPC」や「監視済みWEBサーバー」を製品（Product）として定義。開発者はカタログから選択して起動するだけで、社内ルールに準拠した構成が即座に手に入る。
    - **副業での需要**: ★★★★☆。エンタープライズ企業の「インフラ標準化」案件で重宝される。専門家が作ったテンプレートを非専門家に安全に使わせる仕組みとして提案価値が高い。

### Service Catalog の主要概念
| 用語 | 説明 |
| :--- | :--- |
| **Product (製品)** | カタログに登録される個々のサービス（実体はCloudFormationテンプレート） |
| **Portfolio (ポートフォリオ)** | 製品をまとめたコレクション。誰にアクセス権を与えるかを制御する単位 |
| **Launch Constraints** | 展開時に使用されるIAMロール。ユーザーの権限を最小限に抑えつつ展開を許可する仕組み |


### ECS ネットワークモード比較

| モード | 特徴 | セキュリティ | 備考 |
| :--- | :--- | :--- | :--- |
| **awsvpc** | タスクごとに専用ENI/IPを付与 | タスク単位でSG適用可能 | **Fargate必須**、推奨モード |
| **bridge** | Dockerブリッジ経由 (ホストENI共有) | ホスト単位の制御 | ポートマッピングが必要 |
| **host** | ホストのNWスタックを直接使用 | ホストと同一権限 | 低レイテンシ、ポート重複不可 |

### ネットワークトラフィック監視の比較

| サービス | 監視レベル | 記録内容 | 適した用途 |
| :--- | :--- | :--- | :--- |
| **VPC Flow Logs** | ネットワーク | 送信元/宛先IP, ポート, プロトコル | 不正アクセス調査、通信拒否の確認 |
| **CloudWatch Logs** | アプリケーション | 標準出力 (stdout), エラー出力 | アプリのエラーログ、デバッグ |
### AWS ログタイプの比較

| ログタイプ | 対象 | 記録内容 | レベル | 具体例 / 制限 |
| :--- | :--- | :--- | :--- | :--- |
| **AWS CloudTrail** | API操作の監査 | リソース作成・削除・設定変更 | 管理プレーン | EC2起動、S3バケット作成 |
| **VPCフローログ** | IPトラフィック | 送信元/宛先IP、ポート、プロトコル | L3/L4 (NW) | アプリ層の情報は含まない |
| **RDSログ** | DB操作 | SQLクエリ、エラー、パフォーマンス | データベース層 | スロークエリ、デッドロック |

### ログの活用戦略

| サービス | 主な用途・分析ポイント |
| :--- | :--- |
| **CloudFrontログ** | キャッシュヒット率、地理的アクセス、4xx/5xxエラー、エッジ応答時間 |
| **ALBログ** | トラフィック分散効率、ヘルスチェック、バックエンド処理時間、アプリ層エラー |
