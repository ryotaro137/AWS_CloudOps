# 勉強日記

## 日付
2026年02月28日

## 学習内容
- **Amazon EFS マウントターゲットとセキュリティグループ**
    - **概要**: EFSファイルシステムをEC2にマウントするには、NFSプロトコル（ポート2049/TCP）を使用した通信が不可欠。
    - **試験ポイント**: **「マウント操作が失敗する」**系のトラブルシューティング問題。新しいAZを追加した際に、マウントターゲットのセキュリティグループで「EC2インスタンスからのポート2049（NFS）インバウンド許可」が漏れていないかが問われる。
    - **実務での使い方**: セキュリティグループの送信元に、EC2インスタンスに割り当てられているセキュリティグループIDを直接指定（相互参照）することで、IP変更に強い安全なアクセス制御を実現する。
    - **副業での需要**: ★★★★★。既存ファイルサーバーのAWS移行（Lift & Shift）や、複数インスタンス間での共有ストレージ構築において、疎通確認は最初の関門。トラブルなく構築・運用できるスキルは必須。
    - **要約**: EFSマウントには、マウントターゲット側のセキュリティグループでNFS（2049番ポート）の通信許可が必須であり、これがないとマウントは失敗する。

- **AWS CloudTrail ログファイルの整合性検証**
    - **概要**: ログファイルの削除や改ざんを検知するために、SHA-256ハッシュとデジタル署名を用いて整合性を確認する機能。
    - **試験ポイント**: **「コンプライアンス」や「セキュリティ監査」**の要件として、ログの正当性を証明する必要がある場合に選択される。また、改ざん防止（S3 Object Lock）とセットで問われることが多い。
    - **実務での使い方**: 有効化するとダイジェストファイル（検証用ファイル）が生成される。監査時に `aws cloudtrail validate-logs` コマンドを実行し、過去の操作記録が正しいことを公的に証明する。
    - **副業での需要**: ★★★★☆。金融系や医療系など、高度なセキュリティ・コンプライアンスが求められるプロジェクトでは必須の設定。設定自体は容易だが、その「目的（監査対応）」を説明できることがプロとしての差別化になる。
    - **要約**: CloudTrailの整合性検証を有効にすると、ハッシュ値と署名によりログの「非改ざん性」を証明でき、監査要件を満たすことが可能になる。

- **NAT Gateway vs Internet Gateway (双方向通信の要件)**
    - **概要**: NAT Gatewayはアウトバウンド（送信）専用。インバウンド（受信）が必要な場合はInternet Gateway (IGW) を介した構成が必須。
    - **試験ポイント**: **「外部からのアクセス（受信）が必要か」**が判断の分かれ目。NAT Gatewayはプライベートリソースの更新等（送信）には適しているが、外部からの直接接続はサポートしていない点がひっかけとして出題される。
    - **実務での使い方**: Webサーバーのように外部公開が必要なものはパブリックサブネット＋IGW。DBや内部APIのように外部公開せず、パッチ適用等の通信だけが必要なものはプライベートサブネット＋NAT Gatewayと使い分ける。
    - **副業での需要**: ★★★★★。コスト削減の観点でNAT Gateway（時間単価＋通信量課金）を避けたいケースもあり、要件に応じてIGW（パブリック配置）かNAT Gatewayか、あるいはSSM Session Manager（IGW/NATGなし）かを提案できると非常に重宝される。
    - **要約**: NAT Gatewayは外部からの接続（受信）をサポートしていない。双方向通信が必要な場合は、リソースをパブリックサブネットに配置しIGWを使用する必要がある。

- **Amazon Route 53 Resolver (ハイブリッドDNS解決)**
    - **概要**: AWSとオンプレミス間の名前解決を仲介するマネージドサービス。インバウンド/アウトバウンドのエンドポイントと転送ルールで構成される。
    - **試験ポイント**: **「オンプレミスとの双方向の名前解決」**がキーワード。アウトバウンドエンドポイント＋転送ルール（特定のドメインをオンプレミスDNSへ送る）の組み合わせが頻出。また、エンドポイントをマルチAZ配置にして高可用性を確保する設計も重要。
    - **実務での使い方**: Direct ConnectやVPNを介してオンプレ資産と連携する場合、オンプレミス側のDNS設定を変更せずに、特定の社内ドメインだけをオンプレ側に流し、それ以外はRoute 53で解決する「条件付きフォワーディング」を実装する。
    - **副業での需要**: ★★★★☆。ハイブリッド構成のエンタープライズ案件では必須。DNS設計のミスはシステム全体の疎通不可を招くため、エンドポイントのSG設定（UDP 53番許可）やルーティングまで含めて設計できるエンジニアは信頼される。

| 機能 | 役割 | 通信の方向 | 主な用途 |
| :--- | :--- | :--- | :--- |
| **インバウンドエンドポイント** | クエリを受信 | オンプレ → VPC | オンプレからAWS上のプライベートホストゾーンを解決 |
| **アウトバウンドエンドポイント** | クエリを転送 | VPC → オンプレ | AWSからオンプレミス側の独自ドメインを解決 |
| **転送ルール (Forwarding Rules)** | 条件定義 | - | 「どのドメイン」を「どのIP(オンプレDNS)」に送るかを指定 |

> [!TIP]
> **初心者向け：インバウンドエンドポイントの例え話**
> DNSとは「名前からIPアドレス（電話番号）を調べる電話帳」です。
> - **課題**: オフィスの電話帳には、クラウド（AWS）内部の番号が載っていない。
> - **解決**: AWS側に「外部専用の受付窓口（インバウンドエンドポイント）」を作る。
> - **動き**: オフィスの人がAWSの番号を知りたい時、オフィスの電話帳が自動的に「AWSの窓口」へ問い合わせを転送してくれる。
> - **結果**: 離れたオフィスからでも、クラウド内のプライベートな名前で電話（通信）ができるようになる！

- **要約**: Route 53 Resolverは、インバウンド（受信）とアウトバウンド（送信）のエンドポイントを使い分けることで、AWS・オンプレ間のシームレスな相互名前解決を実現する。

- **AWS Config × SSM Automation による自動修復 (Remediation)**
    - **概要**: AWS Configで設定違反（セキュリティグループの広域開放など）を検知し、SSM Automationで即座に自動修復する仕組み。
    - **試験ポイント**: **「継続的な監視」と「自動修復」**がセットで問われた際の鉄板構成。特に SSH(22) や RDP(3389) の `0.0.0.0/0` 開放を検知し、SSMのランブック（`AWS-DisablePublicAccessForSecurityGroup` など）でルールを自動削除するシナリオが頻出。
    - **実務での使い方**: ガバナンス維持のため、開発者が誤って全開放してしまったSGを数秒〜数分以内に自動で閉塞。管理者にSNSで通知しつつ、監査ログとしてエビデンスを残す「ガードレール」として運用する。
    - **副業での需要**: ★★★★★。セキュリティ事故を未然に防ぐ仕組みは、特にスタートアップから中堅以上の企業まで非常に高く評価される。「作って終わり」ではなく「ガバナンスを効かせ続ける」提案は、保守運用フェーズの契約にも繋がりやすい。
    - **要約**: AWS Configでセキュリティグループの不適切な開放を検知し、SSM Automationのランブックを用いて自動的にルール削除等の修復アクションを実行することで、完全な自動修復を実現する。

- **NAT Gateway のトラフィック分析 (VPC Flow Logs × Insights)**
    - **概要**: NAT GatewayのENIに対してVPC Flow Logsを有効化し、CloudWatch Logs Insightsでクエリをかけることで、高負荷なインスタンスを特定する手法。
    - **試験ポイント**: **「コストの高い通信を行っているインスタンスの特定」**や「NATゲートウェイ利用料金の削減」といったシナリオで頻出。フローログを収集し、送信元IP（srcaddr）ごとにバイト数（bytes）を集計するクエリを投げるのが正解パターン。
    - **実務での使い方**: 「今月はNAT Gatewayの課金が高いな」と感じた際に、Insightsで `stats sum(bytes) by srcaddr` といったクエリを実行。想定外のバックアップ通信やデータ転送を行っている「Top Talker」を迅速に割り出し、構成変更（VPCエンドポイントの導入など）の判断材料にする。
    - **副業での需要**: ★★★★★。AWSのコスト最適化（FinOps）は非常にニーズが高い。単に「高いですね」で終わらず、「このインスタンスがこれだけ通信しているので、S3 Gateway Endpointを入れれば月◯◯ドル浮きます」とデータに基づいた提案ができると、信頼は絶大になる。
    - **要約**: NAT GatewayのENIでフローログを取り、Logs Insightsで集計することで、最も多くのトラフィック（代金）を発生させているインスタンスを即座に特定できる。

- **VPC トラフィックミラーリング (Deep Packet Inspection)**
    - **概要**: EC2のネットワークトラフィックを複製（ミラーリング）して、分析用のターゲットへ転送する機能。
    - **試験ポイント**: **「ペイロード（データ中身）の解析」や「ディープパケットインスペクション (DPI)」**が必要な場合に選択される。VPC Flow Logsはメタデータ（IP, ポート等）のみだが、トラフィックミラーリングはパケットそのものをコピーする点が決定的な違い。
    - **実務での使い方**: 侵入検知システム (IDS) や、サードパーティのセキュリティ分析ツールに生のトラフィックを流し込み、アプリケーション層レベルでの不正な動きを検知するために利用する。
    - **副業での需要**: ★★★☆☆。一般的なアプリ構築では過剰な場合が多いが、金融・政府系などのハイエンドなセキュリティ要件がある案件では必須知識。設定によりインスタンスの性能や帯域に影響を与える可能性があるため、慎重な設計が求められる。
    - **要約**: VPCトラフィックミラーリングは、パケットのペイロードを含む完全なデータを複製して分析ターゲットに送信することで、詳細なインスペクション（精査）を実現する。

- **EC2 スポットインスタンスと配分戦略 (Allocation Strategy)**
    - **概要**: AWSの余剰キャパシティを最大90%引きで利用できるが、AWS側の都合で中断される可能性のあるモデル。
    - **試験ポイント**: **「中断リスクの最小化」**と**「コスト最適化」**のバランスが問われる。Auto Scalingで複数のインスタンスタイプを混ぜる構成や、用途に応じた配分戦略の選択（特に `capacity-optimized`）が頻出。
    - **実務での使い方**: ステートレスなWebサーバーやバッチ処理、EKS/ECSのデータプレーンとして活用。スポットインスタンスアドバイザーで中断頻度が低いタイプを確認し、複数のインスタンスタイプを指定（混合インスタンス構成）することで、特定のタイプが枯渇しても他で補填できるように設計する。
    - **副業での需要**: ★★★★★。既存のオンデマンド構成をスポットに切り替えるだけで大幅なコスト削減（例：月数十万円→数万円）が可能なため、利益に直結する提案として非常に価値が高い。

### スポット配分戦略の比較
| 戦略 | 特徴 | 主な用途 |
| :--- | :--- | :--- |
| **lowest-price** | 指定した中で最も安価なプールから起動 | コスト最優先のバッチ処理など |
| **capacity-optimized** | 最も空き容量が豊富な（中断リスクの低い）プールを優先 | 可用性を重視するWebサーバーやコンテナ基盤 |
| **diversified** | 指定したすべてのプールに均等に分散して配置 | 大規模フリートで特定タイプの一斉中断リスクを避けたい場合 |

- **要約**: スポットインスタンスはコスト削減に強力だが、中断リスクがある。可用性を高めるには「複数タイプの混在」と、中断リスクを抑える「capacity-optimized」戦略の組み合わせがベストプラクティス。

- **AWS CloudFormation StackSets (マルチアカウント管理)**
    - **概要**: 複数のAWSアカウントや組織単位（OU）に対して、CloudFormationテンプレートを一括展開・管理できる機能。
    - **試験ポイント**: **「マルチアカウント環境への一括デプロイ」や「組織全体での設定の一貫性確保」**がキーワード。特に、IAMロール、Configルール、SecurityHubの設定などを全支社・全部署のアカウントに同期させるシナリオで正解となる。
    - **実務での使い方**: AWS Organizationsと連携し、新しいアカウントが作成された際に自動的に「セキュリティ監査用のIAMロール」や「ログ転送設定」をデプロイするように設定。管理コストを極限まで下げつつガバナンスを維持する。
    - **副業での需要**: ★★★★☆。複数のAWSアカウントを運用する中〜大規模案件で重宝される。「各アカウントに手動で設定してください」ではなく「StackSetsで自動同期させましょう」と提案できると、高度なクラウドガバナンススキルをアピールできる。
    - **要約**: CloudFormation StackSetsは、管理者アカウントから複数のアカウントやOUへテンプレートを一斉配布することで、組織全体の設定（IAMロール等）を容易かつ一貫して管理する。

- **Amazon Data Lifecycle Manager (DLM)**
    - **概要**: EBSスナップショットやAMIの作成・保持・削除を自動化するライフサイクル管理サービス。
    - **試験ポイント**: **「スケジュールに基づいたバックアップの自動化」**がキーワード。AWS Backupほどの広範なカバー（RDSやS3等）は不要で、EBSやAMIに特化してシンプルかつ安価にバックアップ運用を回したい場合に正解となる。
    - **実務での使い方**: 「毎日AM2時に取得、7世代保持」といったポリシーを定義し、タグベース（例：`Backup: true`）で対象を自動特定して運用する。
    - **副業での需要**: ★★★★☆。バックアップ未整備の案件において、Lambdaなどのスクリプトを自作せず「マネージドサービスによる標準的な自動化」を最短で導入できるため、保守性の高い提案として評価される。
    - **要約**: Amazon DLMは、EBSやAMIのバックアップライフサイクル（作成から削除まで）をポリシーベースで完全に自動化し、低コストで運用負荷を軽減する。

- **ネットワークACL (NACL) と 通信フロー・トラブルシューティング**
    - **概要**: サブネットレベルで動作するステートレスなファイアウォール（NACL）と、データベース接続におけるエフェメラルポート（一時ポート）の役割、問題切り分け手法。
    - **試験ポイント**: **「NACLはステートレス」**という点がすべての基本。WebサーバーからDB（3306番等）へ通信した際、DBからの「戻りの通信（エフェメラルポート: 1024-65535）」をNACL側で許可し忘れるひっかけ問題が頻出する。
    - **実務での使い方**: 基本的なアクセス制御は管理が容易な「セキュリティグループ (SG)」で行い、NACLは「特定の悪意あるIPを明示的にDeny（拒否）する」ための追加の防御レイヤーとして限定的に使用するのがベストプラクティス。
    - **副業での需要**: ★★★★★。「DBに繋がらない」「通信が通らない」といったトラブルシューティングはインフラエンジニアの最重要スキル。VPCフローログを活用し、「SGの問題か、NACLの問題か、ルートテーブルか」を段階的に切り分けられる能力は現場で非常に頼りにされる。

### セキュリティグループ (SG) と ネットワークACL (NACL) の比較
| 項目 | セキュリティグループ (SG) | ネットワークACL (NACL) |
| :--- | :--- | :--- |
| **適用レベル** | インスタンスレベル | サブネットレベル (配下全体) |
| **ステート（状態）** | **ステートフル** (行きが許可なら戻りも自動許可) | **ステートレス** (行き・戻りの双方で許可が必要) |
| **ルールの評価** | すべてを統合して評価 (Allowのみ) | 番号順に評価 (Allow / Deny 両方設定可能) |
| **戻り通信の考慮** | 自動的に許可されるため意識不要 | **エフェメラルポート (1024-65535) の許可必須** |

- **要約**: NACLはステートレスであるため、戻りの通信用（エフェメラルポート）の許可設定が必須。通信トラブル時は、SG（インスタンス単位・ステートフル）とNACL（サブネット単位・ステートレス）の違いを理解し、フローログ等を用いてレイヤーごとに原因を特定する。

- **DynamoDB のプロアクティブな監視 (ConsumedReadCapacityUnits)**
    - **概要**: DynamoDBテーブルにおいて、実際に消費された読み取り容量 (RCU) の合計を示すメトリクス。
    - **試験ポイント**: **「スロットリングが発生する前」**の予防的対応がキーワード。プロビジョニングされた容量（上限）に対し、80〜90%などの閾値でCloudWatchアラームを設定し、エラーが起きる前に運用チームへ通知するアプローチが正解となる。
    - **実務での使い方**: 本番環境において、予期せぬトラフィック増の際にサービスダウンやレイテンシ悪化を防ぐため、消費RCU/WCUのアラームを設定。通知を受けたら、手動またはAuto Scalingによってキャパシティを拡張する。
    - **副業での需要**: ★★★★☆。サーバーレスやNoSQLを利用する案件において、「ただ動かす」だけでなく「スロットルによる障害を未然に防ぐ運用設計」ができると、SREやOpsエンジニアとしての信頼が大きく向上する。
    - **要約**: ConsumedReadCapacityUnitsメトリクスを監視して上限（プロビジョニング容量）の8割程度でアラームを飛ばすことで、スロットリングが発生する前に適切なキャパシティ拡張を行える。

- **EC2 プレイスメントグループ (Placement Groups)**
    - **概要**: EC2インスタンスの物理的な配置（同じラックに入れるか、別々のラックに分けるか等）を制御し、パフォーマンス最適化や耐障害性向上を図る機能。
    - **試験ポイント**: **「要件に合った種類の選択」**が最頻出。HPC（高性能計算）で低遅延を求めるならクラスター、少数のクリティカルなインスタンスを物理分離するならスプレッド、HadoopやKafkaなどの大規模分散システムならパーティションが正解となる。
    - **実務での使い方**: 通常はAWSにお任せ（自動配置）でよいが、DBクラスターの冗長化（スプレッド）や、機械学習・動画エンコード用のGPUインスタンス群のネットワーク最適化（クラスター）など、特化用途で明示的に指定する。
    - **副業での需要**: ★★★☆☆。一般的なWeb制作では意識しないが、データ分析基盤やエンタープライズの可用性設計に関わる案件では、インスタンスの「物理配置リスク」まで考慮できるとインフラの専門家として高く評価される。

### プレイスメントグループの種類と使い分け
| 種類 | 特徴 | 適用シナリオ (用途) | 制限事項 |
| :--- | :--- | :--- | :--- |
| **スプレッド (Spread)** | 各インスタンスを別々のハードウェア（電源・ラック）に「少数」分散 | 高可用性Webサーバー、DBクラスター | AZあたり最大7台まで |
| **クラスター (Cluster)** | 単一AZ内で物理的に「近接」配置し、低遅延・高帯域幅 (10Gbps等) を実現 | HPC、機械学習、Hadoop/Sparkの並列処理 | 単一AZ内のみ。物理障害時の同時ダウンリスクあり |
| **パーティション (Partition)** | 論理的なパーティション（区画）に分割し、パーティション間でハードウェアを分離 | Kafka, Cassandra, HDFS等の「大規模」分散システム | AZあたり最大7パーティション、数百台規模をサポート |

- **要約**: プレイスメントグループは、目的に合わせてインスタンスの物理配置ルールを指定する機能。性能重視なら近づける（クラスター）、可用性重視なら離す（スプレッド）、大規模な分散システムなら区画分けする（パーティション）という使い分けが重要。

- **CloudWatch Synthetics vs CloudWatch RUM (プロアクティブ監視)**
    - **概要**: WebサイトやAPIの稼働を監視する2つの手法。Synthetics（外形監視）はスクリプトでユーザー操作を能動的にシミュレートし、RUMは実際のブラウザから受動的にデータを収集する。
    - **試験ポイント**: **「ユーザーが問題を経験（報告）する前に検出（プロアクティブ監視）」**というキーワードがあれば Synthetics (Canary) が正解。RUMは実際のユーザーがアクセスしないとデータが取れないため、事前検知には向かない。
    - **実務での使い方**: サーバーやAPI単体の監視だけでなく、Webサイト全体のFQDNに対して「Heartbeat monitor canary」を設定する。これにより、初期HTMLからJSの読み込み、API連携まで、ユーザー目線での「エンドツーエンドの統合テスト」を定期実行できる。
    - **副業での需要**: ★★★★☆。単なる「サーバーの死活監視(Ping)」ではなく、実際の画面遷移やAPIフローが動いているかを保証する外形監視の導入は、SaaSやECサイトの運用保守案件において非常に高く評価される提案。

### Synthetics と RUM の比較
| サービス | 監視方式 | 主な用途・特徴 | 問題の事前検知 |
| :--- | :--- | :--- | :--- |
| **CloudWatch Synthetics** | シミュレーション (能動的) | 定期的な稼働確認、プロアクティブ監視 | **可能 (〇)** |
| **CloudWatch RUM** | 実際のアクセスデータ収集 (受動的) | 実際のシステム影響範囲やパフォ―マンス分析 | 不可 (×) |

- **要約**: 「ユーザーが気付く前に問題を検知したい」ならCloudWatch Syntheticsによるエンドツーエンドのシミュレーション（Canaryスクリプト）を設定する。

- **AWS Cost Explorer と コスト配分タグ (FinOps・コスト可視化)**
    - **概要**: AWSのコストと使用状況を視覚的に分析するツール（Cost Explorer）と、その分析のためにリソースを分類するメタデータ（コスト配分タグ）。
    - **試験ポイント**: **「コスト配分タグは明示的な『有効化』が必要」「過去のデータに遡及して適用することはできない」**という制約事項が頻出。
    - **実務での使い方**: 本番(Prod)やテスト(Dev)、またはプロジェクトごとにタグを設定・有効化し、部門別・環境別のコスト推移を定期的に監視・分析する。異常なコスト増加の早期発見に役立てる。
    - **副業での需要**: ★★★★★。コストへの課題感を持つ企業は多いため、ただインフラを作るだけでなく「コスト配分タグを設計し、Cost Explorerで可視化・最適化する」提案（FinOps）ができるエンジニアは非常に価値が高い。

### コスト管理ツールの比較
| ツール | 主な役割・特徴 | 連携・独立性 |
| :--- | :--- | :--- |
| **AWS Cost Explorer** | 時系列での視覚的なコスト分析、予測、タグによるグループ化 | 使うには「コスト配分タグ」のアクティブ化が必要 |
| **AWS Budgets** | 予算の上限設定と、超過（または予測超過）時のアラート通知 | Cost Explorerとは独立した詳細な監視ツール |
| **Cost and Usage Report (CUR)** | 最も詳細なコスト・使用状況の生データをS3に配信 | BIツール(QuickSight等)でのより高度な独自分析向け |

> [!WARNING]
> **コスト配分タグ運用の落とし穴**
> - **有効化忘れ**: リソースにタグを付けただけではCost Explorerに反映されない。Billingコンソールでの「アクティブ化」が必須。
> - **反映のタイムラグ**: アクティブ化後、データが閲覧可能になるまでに**最大24時間**かかる。
> - **遡及適用不可**: アクティブ化「以降」のコストにのみタグが紐づくため、**過去に発生したコストデータには遡って適用されない**。

- **要約**: Cost Explorerでの詳細な分析には「コスト配分タグ」の設定・有効化が不可欠。ただし、有効化の操作が必要であり、かつ過去のコストデータには遡って反映されない点に注意する。

- **AWS Service Catalog (ガバナンスとセルフサービスの両立)**
    - **概要**: 承認済みのリソース構成（CloudFormation）を「製品」としてカタログ化し、ユーザーに安全なセルフサービス環境を提供するサービス。
    - **試験ポイント**: **「開発者による不適切なリソース起動の防止」や「標準化された構成の配布」**がキーワード。IAMポリシーで直接リソースを作る権限を制限しつつ、Service Catalog経由でのみ起動を許可することで、ガバナンスを強制するシナリオが頻出。
    - **実務での使い方**: 組織で許可された特定のインスタンスタイプや設定済みのテンプレートを「ポートフォリオ」にまとめ、特定のアカウントやユーザーに割り当てる。これにより、初心者が高額なインスタンスを誤って起動するリスクなどを根本から排除できる。
    - **副業での需要**: ★★★★☆。IT部門による「インフラ標準化」を目指す企業において、ガバナンスと自由度を両立させる仕組みとして提案価値が高い。
    - **要約**: AWS Service Catalogは、事前承認済みのリソースのみを「製品」として提供することで、ユーザーの自由度を保ちつつ、不適切な構成の起動を確実に防止する。

- **CloudFront オリジンとしての EFS 制限**
    - **概要**: Amazon EFS を直接 CloudFront のオリジンとして設定することは技術的に不可能。
    - **理由**: CloudFront のオリジンは HTTP/HTTPS プロトコルに対応している必要があるが、EFS は NFS プロトコルを使用する「ファイルシステム」であるため。
    - **試験ポイント**: **「プロトコルの不整合」** による構成の可否を問う問題で頻出。EFS 上のデータを配信したい場合は、EC2（Webサーバー）や Lambda 等を介して HTTP/HTTPS で公開する構成が正解となる。
    - **実務での使い方**: 大規模な静的コンテンツ配信で EFS を使いたい場合は、EC2 インスタンスに EFS をマウントし、その EC2 をカスタムオリジンとして CloudFront に背負わせる。
    - **要約**: CloudFront は NFS プロトコルの EFS を直接参照できない。配信には必ず Web サーバー（EC2 等）を介在させる必要がある。

- **Amazon CloudFront Origin Shield**
    - **概要**: CloudFrontのエッジロケーションとオリジンサーバーの間に追加される「集中キャッシュ層」。
    - **試験ポイント**: **「オリジン負荷の削減」や「キャッシュヒット率の向上」**がキーワード。世界中のエッジロケーションからのリクエストをOrigin Shieldで集約（リクエスト集約）し、オリジンに直接行くリクエストの数を最小限に抑えるシナリオで正解となる。
    - **実務での使い方**: オリジンサーバーのキャパシティが限られている場合や、オリジンへの通信コスト（アウトバウンド通信）を削減したい場合に導入する。特に動画配信や大規模な静的アセット配信で威力を発揮する。
    - **副業での需要**: ★★★★☆。高トラフィックなサイトのパフォーマンス改善やコスト最適化の提案として非常に強力。Origin Shieldを有効化するだけでオリジンのサーバー台数を減らせる可能性があるため、ROI（投資対効果）を説明しやすい。
    - **要約**: Origin Shieldは、複数のエッジからのリクエストを1箇所で集約・キャッシュすることで、オリジンサーバーへの負荷を劇的に減らし、全体のレスポンス性能を高める。

- **Application Load Balancer (ALB) のメトリクス監視**
    - **概要**: ALB が自動で収集・提供する標準メトリクス（RequestCount 等）を用いて、アプリケーションのトラフィック状況や健全性を可視化する手法。
    - **試験ポイント**: **「追加コストを抑えたトラフィック監視」や「過去数週間のトレンド分析」**がキーワード。EC2 の CPU 監視だけでは「アプリ層のリクエスト数」は分からないため、ALB レベルのメトリクス（RequestCount）を使用するのが正解となる。
    - **主要なメトリクス**:
        - `RequestCount`: 処理されたリクエスト総数（トラフィック量の把握）。
        - `TargetResponseTime`: ターゲット（EC2 等）の応答時間（パフォーマンス低下の検知）。
        - `HTTPCode_Target_5XX_Count`: サーバーエラー数（障害検知）。
    - **実務での使い方**: CloudWatch コンソールで過去 2 週間の `RequestCount` を 1 分間隔で表示。ピーク時間帯や急激なトラフィック変動を特定し、Auto Scaling のスケーリングポリシー調整やキャパシティプランニングの基礎データとする。
    - **要約**: ALB は標準で `RequestCount` などの詳細なメトリクスを収集しており、これを利用することで、追加コストやカスタム実装なしにアプリ層の正確なトラフィック分析と障害検知が可能になる。

- **AWS Service Quotas (サービス制限の監視と管理)**
    - **概要**: AWS アカウントのリソース使用制限（クォータ）を管理・監視し、必要に応じて引き上げリクエストを行うサービス。
    - **試験ポイント**: **「Auto Scaling の失敗原因」や「リソース上限による起動不可の防止」**がキーワード。CloudWatch アラームと連携して「クォータ使用率（80%等）」を監視し、上限に達する前にプロアクティブに引き上げ申請を行うシナリオが頻出。
    - **実務での使い方**: 新しいリージョンでの展開時や、大規模なキャンペーン等で EC2 インスタンス数や Elastic IP が大量に必要な場合に、事前に Service Quotas コンソールで使用状況を確認し、余裕を持った値を申請しておく。
    - **副業での需要**: ★★★★☆。急激な成長を遂げるスタートアップ等の案件において、「設定は合っているはずなのにインスタンスがこれ以上増えない（クォータ制限）」というトラブルを未然に防ぐ、安定運用のプロとしての差別化ポイントになる。
    - **要約**: AWS Service Quotas を CloudWatch アラームと連携させることで、リソース上限に達してスケーリングが止まる前に通知を受け取り、計画的な引き上げ申請やキャパシティ管理が可能になる。

- **AWS Security Hub (セキュリティの統合・集中管理)**
    - **概要**: 複数の AWS セキュリティサービス（GuardDuty、Inspector など）からの検出結果を集約し、CIS Benchmark や PCI DSS といったセキュリティ標準への準拠状況をスコア化・評価する統合管理サービス。
    - **試験ポイント**: **「組織全体（マルチアカウント）の包括的なセキュリティ評価」**がキーワード。AWS Organizations と連携させることで、新しく作られたアカウントに対しても自動で Security Hub を有効化（手動招待を排除）し、CIS Benchmark の自動評価を強制できる点が最重要。
    - **他のセキュリティサービスとの比較**:
        - **GuardDuty**: 機械学習ベースの「脅威検知・異常検知」（設定基準の評価機能はない）。
        - **Inspector**: EC2 やコンテナの「脆弱性診断」。
        - **Config**: リソースごとの詳細な「設定履歴とルール評価」（CIS のような包括的なスコア付けにはカスタマイズが必要）。
    - **実務での使い方**: AWS Organizations の管理者アカウント（セキュリティ専用アカウント）で Security Hub を集約。すべてのアカウントのセキュリティスコアとコンプライアンス遵守状況を一元的なダッシュボードで日々監視する。
    - **副業での需要**: ★★★★★。アカウント数が増えれば増えるほど管理が煩雑になるため、「Organizations × Security Hub」で監査と通知を自動化する仕組みは、組織のセキュリティガバナンス構築の要になります。
    - **要約**: AWS Security Hub は AWS Organizations と統合することで、マルチアカウント環境において CIS Benchmark 等の評価を自動化・一元管理し、手動の運用負荷を最小限に抑えながら高度なセキュリティ管理を実現する。

- **Amazon S3 インベントリ (オブジェクトの可視化と暗号化ステータス確認)**
    - **概要**: S3バケット内のオブジェクト一覧と、それぞれのサイズ・最終更新日・暗号化ステータスなどの「メタデータ」を日次/週次で自動レポート出力（CSV等）する機能。
    - **試験ポイント**: **「バケット内の全オブジェクトの暗号化状態を確認したい」「手動スクリプトを使わずに自動化したい」**という要件に対する最適解として頻出。`Encryption-Status` フィールドを見ることで、すべてのオブジェクトが正しく暗号化されているかを一目で監査できる。
    - **S3 の暗号化オプション**:
        - `SSE-S3`: S3が管理するキーを使用（現在のS3デフォルト）。
        - `SSE-KMS`: AWS KMSキーを使用（アクセス制御をより厳密にしたい場合）。
        - `SSE-C`: ユーザー（顧客）独自のキーを手動で提供。
        - **クライアントサイド**: ユーザーのアプリ側で暗号化してからS3にアップロード。
    - **実務での使い方**: 大規模なバケット（数百万〜数億オブジェクト）において、「未暗号化の古いファイルが残っていないか」や「どのストレージクラスがどれだけ容量を占めているか」を、Athena等と連携してクエリ・分析するためのデータソースとして利用する。
    - **副業での需要**: ★★★☆☆。セキュリティ監査やコスト分析の文脈で、「S3の中身をAPIで1件ずつリストアップするとコストと時間がかかるため、インベントリを使いましょう」と提案できると、AWSの仕様を深く理解している証明になる。
    - **要約**: S3インベントリを使用することで、大量のオブジェクトに対する「暗号化ステータスの監査」や「メタデータレポート生成」を、手動のAPI呼び出しなしにスケーラブルかつ自動的に実行できる。

- **Amazon CloudWatch Synthetics (高度な外形監視とユーザージャーニーテスト)**
    - **概要**: アプリケーションやAPIに対し、本物のユーザー体験に近い操作（ログイン、カート追加等）をシミュレートする「Canaryスクリプト（Node.js/Puppeteerベース）」を定期実行し、継続監視するマネージドサービス。
    - **試験ポイント**: **「複雑なユーザーシナリオの監視」や「運用負荷の最小化」**がキーワード。比較対象として「Route 53ヘルスチェック（単純な死活監視のみ）」や「自作Lambda関数（スクリプト開発・保守の運用負荷が大きい）」が出題され、Syntheticsによるマネージドな解決が正解となる。
    - **主要機能とメトリクス**:
        - スクリプト実行後、スクリーンショット、HARファイル（通信ログ）、動作ログを自動生成。
        - `SuccessPercent`（成功率）などのメトリクスにアラームを設定可能（例: 成功率95%未満で通知）。
        - マルチリージョンからの同時監視による地理的な障害や遅延の検知。
    - **実務での使い方**: Eコマースサイトなどで「トップページ表示 → ログイン → カート追加」というクリティカルなビジネスフローをカスタムCanaryとして定義し、1〜60分間隔で定期実行する。これにより、「サーバーは動いているが機能が壊れている」というサイレント障害を検知できる。
    - **副業での需要**: ★★★★★。SaaSやWebサービスの運用において、UX（ユーザーエクスペリエンス）の低下や致命的なバグを顧客からの問い合わせ前に気付ける体制（外形監視）の構築は、圧倒的に高い評価を受けるスキルです。
    - **要約**: CloudWatch SyntheticsのCanaryは、Route 53や自作Lambdaの限界を超え、ユーザー目線の複雑な操作テストと成功率監視（SuccessPercent）を低負荷かつ高度に自動化できる。

- **Amazon ElastiCache for Memcached (キャッシュと Evictions 監視)**
    - **概要**: データベースの高負荷を軽減し、アプリケーションの応答速度を劇的に向上させるシンプルなインメモリキャッシュシステム。
    - **試験ポイント**: **「Evictions (エビクション) メトリクス」と「スケーリングの判断」**が頻出。Evictionsは「メモリ不足により古いデータが追い出された」状況を示し、これが多発・継続する場合は「より大きなノードへの変更 (スケールアップ/垂直)」または「ノードの追加 (スケールアウト/水平)」が必要となる。
    - **スケーリング戦略**:
        - **スケールアップ (垂直)**: ノードサイズ自体を大きくする。設計がシンプルだが、単一ノードの上限や再起動等の影響を考慮する必要がある。
        - **スケールアウト (水平)**: ノードの台数を増やす。可用性と負荷分散が高まるが、クライアント側でのデータ分散（コンシステントハッシュ等）の複雑性を考慮する。
    - **実務での使い方**: CloudWatchで `Evictions`、`CacheHits`、`CacheMisses` を監視し、ダッシュボード化する。また、インフラの拡張だけでなく、アプリケーション側で「TTL (Time To Live)」を最適化し、不要なデータが勝手に消えるようにする「キャッシュ設計」が実務では極めて重要。
    - **副業での需要**: ★★★★☆。DBの高負荷によるパフォーマンス劣化は多くの企業が抱える課題。ただキャッシュサーバーを立てるだけでなく、「Evictionsを監視し、スケールアウトのタイミングを計画できる」「適切なTTLを提案できる」エンジニアは高く評価される。
    - **要約**: ElastiCache (Memcached) におけるメモリ不足の兆候は `Evictions` メトリクスで検知する。対策としてインフラのスケーリング（スケールアップ/アウト）と、アプリ層での TTL 等の最適化を組み合わせて運用する。

- **Application Load Balancer (ALB) のヘルスチェックと監視**
    - **概要**: ALB が背後のターゲット（EC2 等）に定期的に HTTP/HTTPS リクエストを送り、アプリケーション層が正常に応答しているかを評価する仕組み。
    - **試験ポイント**: **「EC2 ステータスチェックとの違い」**。EC2 のステータスチェック（システム/インスタンス）はハードウェアや OS の稼働確認に留まるが、ALB ヘルスチェックは「アプリケーション（Web サーバー等）が実際にリクエストを処理できるか」まで監視する点が正解の鍵となる。
    - **主要メトリクス**:
        - `HealthyHostCount`: 正常なターゲット数（0 なら全滅）。
        - `UnhealthyHostCount`: 異常なターゲット数。
    - **実務での使い方**: アプリケーションの動作確認専用のパス（例: `/health`）をヘルスチェック先として設定し、DB 接続なども含めた総合的な健全性をテストさせるのがベストプラクティス。CloudWatch で `HealthyHostCount` が想定数より減った際にアラームを通知し、Auto Scaling の切り離しと合わせて運用する。
    - **副業での需要**: ★★★★☆。可用性設計の基本となるため、単なる Ping 監視だけでなく、「ALB のヘルスチェックを使ってアプリのハングアップを自動検知して切り離す設計」はインフラ基盤構築の案件で必須の要件。
    - **要約**: ALB ヘルスチェックは EC2 レベルの監視では気付けないアプリケーション層の障害を検知でき、`HealthyHostCount` 等のメトリクス監視と組み合わせることで高い可用性を実現する。

- **AWS Config マネージドルール**
    - **概要**: AWS があらかじめ定義して提供している、ベストプラクティスに基づいた設定評価ルール。ユーザーはルールを選ぶだけで、自アカウントのリソースが要件（セキュリティ基準等）を満たしているかを継続的にチェックできる。
    - **試験ポイント**: **「カスタムルール（Lambda）を作らなくて済む」** という点がよく出題される。例えば、「SSHポート(22)が全公開されていないか（`vpc-sg-open-only-to-authorized-ports` 等）」や「EBSボリュームが暗号化されているか（`encrypted-volumes`）」といった一般的な要件は、マネージドルールを有効化するだけで簡単に評価できる。
    - **実務での使い方**: 新しい AWS 環境を構築した際、まずはマネージドルールをベースラインとして設定し、セキュリティの穴がないか継続的に監視させる。違反が見つかった場合は、先述の「SSM Automation」と紐づけて自動修復（Remediation）を走らせるのが鉄板パターン。
    - **副業での需要**: ★★★★☆。セキュリティチェックの仕組みを一元的に導入する際、一からLambda関数（カスタムルール）を書くのではなく、「まずはAWSのマネージドルールで7〜8割の要件をカバーし、運用コストを下げましょう」と提案できるとプロとして信頼される。
    - **要約**: AWS Config のマネージドルールを活用することで、開発や運用の手間（Lambda作成など）をかけずに、AWSのベストプラクティスに沿ったコンプライアンス監視をすぐに導入できる。

- **CloudWatch Synthetics Canary (詳細仕様と運用ポイント)**
    - **Canaryの種類（テンプレート）**:
        - **ハートビート監視**: 単一URLの死活・応答速度。
        - **API Canary**: REST APIの機能テスト。
        - **ブロークンリンク**: ページ内のリンク切れチェック。
        - **ビジュアル監視**: 画面レイアウトの崩れを検知。
    - **成功率（SuccessPercent）の定義**: 「指定期間内の成功回数 ÷ 総実行回数 × 100」。このメトリクスにアラームをかけることで、一時的なエラーではなく「継続的なサービス品質低下」を正確に捉えられる。
    - **デバッグ支援**: 失敗時に「スクリーンショット」「HARファイル（パケットログ）」「実行ログ」をセットで提供してくれるため、原因特定が非常に速い。
    - **要約**: Canaryは用意されたテンプレートを使うことで、ログインやAPI連携といった「正常に動いて当然のパス」の監視を最短で導入でき、トラブル時の詳細エビデンスを自動収集する強力なツール。

- **AWS Control Tower (マルチアカウント管理とガバナンスの自動化)**
    - **Landing Zone**: AWSのベストプラクティス（AWS Organizations, IAM Identity Center等）に基づいたセキュアなマルチアカウント環境を自動でセットアップ・維持する。
    - **ガードレール (Guardrails)**:
        - **予防的ガードレール**: SCP (Service Control Policies) を利用して、不適切なアクション（例：特定リージョン以外でのリソース作成）を物理的に禁止する。
        - **発見的ガードレール**: AWS Config を裏側で利用し、ポリシー違反の設定を継続的に監視・検知する。
    - **Account Factory**: 新しいAWSアカウントを払い出す際、あらかじめ定義されたネットワーク設定やセキュリティ設定を自動適用し、プロビジョニングを標準化する。
    - **要約**: Control Towerは、複数のAWSアカウントに対して一貫した統制（ガバナンス）を効かせるためのオーケストレーションサービスであり、大規模組織やマルチアカウント運用を始める際の「土台」として不可欠な存在。

- **AWS KMS キーの種類と暗号化 AMI の共有**
    - **概要**: KMS キーには「AWS 管理キー (aws/...)」と、ユーザーが自由に制御できる「カスタマー管理キー (CMK)」があり、特に暗号化されたリソースをアカウント間で共有する際にその違いが重要となる。
    - **試験ポイント**: **「暗号化された AMI のアカウント間共有」**が超重要項目。
        - AWS 管理キーで暗号化された AMI は**直接共有できない**。
        - 共有するには、AMI を**カスタマー管理キー (CMK)** で再暗号化してコピーし、その CMK のキーポリシーで共有先のアカウントを許可する必要がある。
    - **重要なキーポリシー権限**:
        - `kms:Decrypt`: AMI からインスタンスを起動する際に必須。
        - `kms:CreateGrant`: EC2 サービスがボリュームを作成することを許可するために必要。
        - `kms:DescribeKey`, `kms:ReEncrypt*`: コピーやメタデータ取得に必要。
    - **実務での使い方**: 組織のゴールデンイメージ（AMI）を開発・テスト・本番用アカウントに配布する際、自前の CMK を作成し、そのポリシーを各環境からアクセスできるように構成する。
    - **副業での需要**: ★★★★☆。マルチアカウント環境のセキュリティ設計において、共有 AMI の扱いはトラブルになりやすいポイント。KMS ポリシーの疎通エラーを素早く解決できるエンジニアは信頼される。
    - **要約**: 暗号化 AMI を共有するには「カスタマー管理キー (CMK)」での再暗号化が必須であり、キーポリシーで適切に `Decrypt` や `CreateGrant` を許可することで、セキュアな配布が可能になる。

- **AWS CloudFormation リソース作成順序の制御 (DependsOn)**
    - **概要**: CloudFormation はデフォルトで `Ref` や `GetAtt` を使った参照関係から依存関係を自動検出し、可能な限り並列でリソースを作成する。参照関係がない場合でも作成順序を強制したい場合に `DependsOn` 属性を使用する。
    - **試験ポイント**: **「リソースの作成順序の制御」と「CreationPolicy / WaitCondition との違い」**。`DependsOn` はリソース自体の作成順序を制御し、`WaitCondition` 等はリソース作成後の設定（アプリインストール等）の完了を待つ（シグナルを待つ）ために使用される。
    - **重要な属性/機能**:
        - `DependsOn`: 参照関係がないリソース（例: GWアタッチメントが完了してからEC2を起動したい等）の順序を明示。
        - `CreationPolicy` / `WaitCondition`: EC2 のユーザーデータによるアプリ初期化完了などを「待つ」ための仕組み。
        - テンプレート記述順序: インフラ構築の順序には**影響しない**（全体のグラフで決定される）。
    - **実務での使い方**: 依存関係にあるサービスが完全に有効化される前に作成が試行されエラーになるのを防ぐために、`DependsOn` で明示的な待機を入れる。また、複数アカウント展開には `StackSets` を使用する。
    - **副業での需要**: ★★★☆☆。複雑な IaC 構成において「たまにプロビジョニングに失敗する」不具合のデバッグにおいて、この依存関係の制御知識はプロの信頼を得るために重要。
    - **要約**: CloudFormation の作成順序は参照関係（Ref/GetAtt）による自動検出が基本。明示的な順序制御には `DependsOn` を使い、アプリ起動完了等のシグナルを待つ場合は `CreationPolicy / WaitCondition` を使い分ける。

- **AWS Organizations の組織 ID と S3 バケットポリシー制御 (`aws:PrincipalOrgId`)**
    - **概要**: S3 などのリソースベースポリシー（バケットポリシー）において、アクセス元の条件として「特定の AWS Organizations 配下のアカウントかどうか」を判定できる機能。
    - **試験ポイント**: **「アカウントが増えてもポリシーを更新しなくてよい」「組織外からのアクセスを自動的にブロック」**という要件に対する最適解として頻出。アカウント ID をベタ書きするのではなく、組織 ID (`o-xxxxxxxxxx`) と `aws:PrincipalOrgId` を使うのが正解となる。
    - **ポリシー実装の仕組み**:
        - `Principal: "*"` で全ユーザーを対象にしつつ、`Condition` ブロックで `StringEquals: {"aws:PrincipalOrgId": "o-xxxxxxxxxx"}` を指定する。
        - これにより、組織に新しいアカウントが追加されても、バケットポリシーを一切変更することなく自動でアクセスが許可される（スケーラビリティが高い）。
    - **実務での使い方**: 自社内のデータを一元管理する「データレイク（S3）」を構築する際、全社（全アカウント）からのアクセスは許可しつつ、社外（外部アカウント）からのアクセスは絶対にブロックしたい場合、この条件キーを標準ルールとして組み込む。
    - **副業での需要**: ★★★★★。アカウントが増え続ける成長企業において、「アカウント追加のたびに数々の IAM/S3 ポリシーを更新する手間」を削るのはクラウドアーキテクトの腕の見せ所。この設計思想は高く評価される。
    - **要約**: `aws:PrincipalOrgId` を用いた S3 バケットポリシーは、マルチアカウント組織でのアクセス制御を「アカウント単位」から「組織全体の境界（境界防御）」へと引き上げ、運用負荷とセキュリティリスクの双方を劇的に下げる。
